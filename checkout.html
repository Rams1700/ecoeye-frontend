<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eco Eye | Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Same CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
<header>
  <nav class="navbar">
    <a class="logo" href="index.html">
      <span class="dot">ğŸŒ</span> Eco Eye
    </a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="categories.html">Eco Products</a></li>
      <li><a href="cart.html">Cart</a></li>
      <li><a href="report.html">Report Garbage</a></li>
      <li><a href="feedback.html">Feedback</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<main class="content">
  <h1>ğŸ“¦ Delivery Address</h1>
  <p style="text-align:center;">Please enter your address to confirm the order</p>

  <form id="addressForm">

    <label>Full Name *</label>
    <input type="text" required placeholder="John Doe">

    <label>Phone Number *</label>
    <input type="tel" required placeholder="+91 98765 43210">

    <label>Address *</label>
    <textarea required placeholder="House no, street, area"></textarea>

    <label>City *</label>
    <input type="text" required placeholder="Bengaluru">

    <label>State *</label>
    <input type="text" required placeholder="Karnataka">

    <label>Pincode *</label>
    <input type="text" required placeholder="560001">

    <button type="submit" class="btn">Confirm Order</button>
  </form>
</main>

<footer>
  <p>Â© 2025 Eco Eye | Shop Sustainably ğŸŒ±</p>
</footer>

<script>
const API_BASE_URL = "https://ecoeye-backend.onrender.com";

document.getElementById("addressForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const cart = JSON.parse(localStorage.getItem("ecoeye_cart")) || [];
  if (cart.length === 0) {
    alert("ğŸ›’ Cart is empty");
    return;
  }

  const form = e.target;
  const inputs = form.querySelectorAll("input, textarea");

  const [fullName, phone, address, city, state, pincode] =
    Array.from(inputs).map(i => i.value.trim());

  if (!fullName || !phone || !address || !city || !state || !pincode) {
    alert("â— Please fill all address fields");
    return;
  }

  const orderData = {
    items: cart,
    total: cart.reduce((s, i) => s + i.price * i.quantity, 0),
    deliveryAddress: { address, city, state, pincode }
  };

  try {
    const res = await fetch(`${API_BASE_URL}/api/orders`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(orderData)
    });

    const data = await res.json();

    if (res.ok) {
      localStorage.removeItem("ecoeye_cart");
      window.location.href = "order-success.html";
    } else {
      alert("âŒ Order failed: " + (data.message || "Unknown error"));
    }
  } catch (err) {
    console.error(err);
    alert("âŒ Backend not reachable");
  }
});
</script>




</body>
</html>
