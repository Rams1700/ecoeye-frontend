<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eco Eye | Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Same CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
<header>
  <nav class="navbar">
    <a class="logo" href="index.html">
      <span class="dot">üåç</span> Eco Eye
    </a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="categories.html">Eco Products</a></li>
      <li><a href="cart.html">Cart</a></li>
      <li><a href="report.html">Report Garbage</a></li>
      <li><a href="feedback.html">Feedback</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<main class="content">
  <h1>üì¶ Delivery Address</h1>
  <p style="text-align:center;">Please enter your address to confirm the order</p>

  <form id="addressForm">

    <label>Full Name *</label>
    <input type="text" required placeholder="John Doe">

    <label>Phone Number *</label>
    <input type="tel" required placeholder="+91 98765 43210">

    <label>Address *</label>
    <textarea required placeholder="House no, street, area"></textarea>

    <label>City *</label>
    <input type="text" required placeholder="Bengaluru">

    <label>State *</label>
    <input type="text" required placeholder="Karnataka">

    <label>Pincode *</label>
    <input type="text" required placeholder="560001">

    <button type="submit" class="btn">Confirm Order</button>
  </form>
</main>

<footer>
  <p>¬© 2025 Eco Eye | Shop Sustainably üå±</p>
</footer>

<script>
document.getElementById("addressForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  // 1Ô∏è‚É£ Get cart
  const cart = JSON.parse(localStorage.getItem("ecoeye_cart")) || [];

  if (cart.length === 0) {
    alert("üõí Cart is empty");
    return;
  }

  // 2Ô∏è‚É£ Get form values
  const form = e.target;
  const fullName = form.querySelector('input[placeholder="John Doe"]').value.trim();
  const phone = form.querySelector('input[type="tel"]').value.trim();
  const address = form.querySelector("textarea").value.trim();
  const city = form.querySelector('input[placeholder="Bengaluru"]').value.trim();
  const state = form.querySelector('input[placeholder="Karnataka"]').value.trim();
  const pincode = form.querySelector('input[placeholder="560001"]').value.trim();

  if (!fullName || !phone || !address || !city || !state || !pincode) {
    alert("‚ùó Please fill all address fields");
    return;
  }

  // 3Ô∏è‚É£ Build order object
  const orderData = {
    customer: {
      name: fullName,
      phone
    },
    items: cart,
    total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0),
    deliveryAddress: { address, city, state, pincode }
  };

  // 4Ô∏è‚É£ SEND TO BACKEND (THIS WAS MISSING)
  try {
    const res = await fetch("http://localhost:5000/api/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(orderData)
    });

    const data = await res.json();

    if (data.success) {
      // 5Ô∏è‚É£ Clear cart & redirect
      localStorage.removeItem("ecoeye_cart");
      window.location.href = "order-success.html";
    } else {
      alert("‚ùå Order failed");
    }

  } catch (err) {
    alert("‚ùå Backend not reachable");
    console.error(err);
  }
});
</script>


</body>
</html>
